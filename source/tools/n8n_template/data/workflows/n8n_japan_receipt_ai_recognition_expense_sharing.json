{
  "name": "å…±åŒè¨˜å¸³_demo",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5f7e16fd-da83-420d-a491-3df046f640d8",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2380,
        -800
      ],
      "id": "667a3e91-872d-4ce3-a897-e82c8ae50d62",
      "name": "LineMessage",
      "webhookId": "5f7e16fd-da83-420d-a491-3df046f640d8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "106d4305-c5cc-404b-913e-893d83641ede",
              "name": "item",
              "value": "={{ $json.item }}",
              "type": "string"
            },
            {
              "id": "7493c2b6-64ea-474d-9fbd-7668bd0d2295",
              "name": "amount",
              "value": "={{ $json.amount }}",
              "type": "number"
            },
            {
              "id": "2069d3c1-dc4c-4c06-91fc-9f393195f42a",
              "name": "place",
              "value": "={{ $json.place }}",
              "type": "string"
            },
            {
              "id": "c9309ee1-6ccf-402f-85d7-168c9e80c70b",
              "name": "note",
              "value": "={{ $json.note }}",
              "type": "string"
            },
            {
              "id": "b003f17f-f291-46b6-a59c-9b7c9dd98a99",
              "name": "datetime",
              "value": "={{ $json.datetime }}",
              "type": "string"
            },
            {
              "id": "ef533709-1fff-4fc5-8afe-26d0a960dff1",
              "name": "replyToken",
              "value": "={{ $('LineMessage').item.json.body.events[0].replyToken }}",
              "type": "string"
            },
            {
              "id": "cc541310-2233-4c6a-974e-fc0fdbf68259",
              "name": "userId",
              "value": "={{ $('LineMessage').item.json.body.events[0].source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -620,
        -1240
      ],
      "id": "00ee2b11-9e49-4c0f-84b4-bf6699917513",
      "name": "å–Lineè³‡æ–™"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM",
          "mode": "list",
          "cachedResultName": "n8n-åœ–ç‰‡è¨˜å¸³-demo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1154469382,
          "mode": "list",
          "cachedResultName": "expense",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit#gid=1154469382"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "item": "={{ $json.item }}",
            "place": "={{ $json.place }}",
            "id": "={{ $json.replyToken.hash() }} ",
            "datetime": "={{ $json.datetime }}",
            "amount": "={{ $json.amount }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "amount",
              "displayName": "amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datetime",
              "displayName": "datetime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "place",
              "displayName": "place",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -160,
        -1140
      ],
      "id": "213b4e55-6f48-43e2-ac16-5aaff17b1405",
      "name": "å¯«å…¥è¨˜å¸³ä¸»è³‡æ–™_Google Sheets1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "atsKA0m2aQXeL6i6",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer kSnAT2HQSvdZ0XsiM6v4670i7x6cXHKcmKZyif0bNQkk8WcmpeQ8/hPi9ccb4pEZjpWUep6S7wLhkhwgX4qbez3DO6tqUSei1p3F57T7bmy44eqBKGPDj1sE1XeF3MEobZ62ka1eCNHwP154IXEiXwdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n\"replyToken\": \"{{ $('å–Lineè³‡æ–™').item.json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"å“é …ï¼š{{ $json.item }}\\né‡‘é¡ï¼š{{$json.amount}}\\næ™‚é–“ï¼š{{ $json.datetime }}\\nåœ°é»ï¼š{{ $json.place }}\\n\\n\"\n    },\n    {\n      \"type\": \"template\",\n      \"altText\": \"è¨˜å¸³æˆåŠŸ\",\n      \"template\": {\n        \"type\": \"buttons\",\n        \"title\": \"è«‹é¸æ“‡æ˜¯å¦æ‹†å¸³\",\n        \"text\": \"ä»¥ä¸‹æ˜¯æ‚¨çš„é¸é …ï¼š\",\n        \"actions\": [\n          {\n            \"type\": \"postback\",\n            \"label\": \"æ‹†å¸³\",\n            \"data\": \"action=split&hash={{ $json.id }}&id={{ $json.id }}\"\n          },\n          {\n            \"type\": \"postback\",\n            \"label\": \"å–®ç¨\",\n            \"data\": \"action=single&hash={{ $json.id }}&id={{ $json.id }}\"\n          },\n          {\n            \"type\": \"postback\",\n            \"label\": \"é‡è©¦\",\n            \"data\": \"action=retry&hash={{ $json.id }}&id={{ $json.id }}\"\n          }\n        ]\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80,
        -1140
      ],
      "id": "2bc66503-88cf-46c0-8c55-92ec6a9a5b22",
      "name": "HTTP Request",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.events[0].message.type }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f7b9c2c4-d6a8-4ca9-9c48-4937ddb865c2"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "57eb1e7a-e71c-4cb4-b7fa-15ac91eea974",
                    "leftValue": "={{ $json.body.events[0].message.type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1880,
        -1040
      ],
      "id": "51676e0a-018f-461f-9a75-b0758a23eac0",
      "name": "Switch"
    },
    {
      "parameters": {
        "url": "=https://api-data.line.me/v2/bot/message/{{ $json.body.events[0].message.id }}/content ",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer kSnAT2HQSvdZ0XsiM6v4670i7x6cXHKcmKZyif0bNQkk8WcmpeQ8/hPi9ccb4pEZjpWUep6S7wLhkhwgX4qbez3DO6tqUSei1p3F57T7bmy44eqBKGPDj1sE1XeF3MEobZ62ka1eCNHwP154IXEiXwdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1640,
        -1160
      ],
      "id": "c1ce54a1-7569-4aa4-b3a1-51087a0a40e4",
      "name": "GetLineImage"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1cff051a-8fd1-43b5-8304-598b4d4b6ba5",
              "name": "text",
              "value": "={{ $json.body.events[0].message.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1640,
        -940
      ],
      "id": "51cf070a-77d9-4660-9299-013e62059eff",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "121152cf-41f5-4b67-982c-b4c9be34e749",
              "name": "replyToken",
              "value": "={{ $('LineMessage').item.json.body.events[0].replyToken }}",
              "type": "string"
            },
            {
              "id": "6750fddf-d59a-4116-aa43-db40140051b3",
              "name": "postbackData",
              "value": "={{ $('LineMessage').item.json.body.events[0].postback.data }}",
              "type": "string"
            },
            {
              "id": "d8bb00d4-ab42-4484-a8c1-2c741a50c886",
              "name": "postbackData_action",
              "value": "={{\n  $('LineMessage').item.json.body.events[0].postback.data\n    .split('&')\n    .find(p => p.startsWith('action='))\n    ?.split('=')[1]\n}}",
              "type": "string"
            },
            {
              "id": "377f6420-ad78-4c18-9557-9985c21b6bcb",
              "name": "postbackData_id",
              "value": "={{\n  $('LineMessage').item.json.body.events[0].postback.data\n    .split('&')\n    .find(p => p.startsWith('id='))\n    ?.split('=')[1]\n}}",
              "type": "string"
            },
            {
              "id": "d5e8900a-b4e2-4dcd-8a8c-995d8b056833",
              "name": "line_uid",
              "value": "={{ $json.body.events[0].source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1900,
        -440
      ],
      "id": "7bb5e18e-2806-4fe3-9b46-d10b4b0801ea",
      "name": "è™•ç†æ‹†å¸³è³‡æ–™"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.postbackData_action }}",
                    "rightValue": "split",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b110a980-4b53-4152-bf10-f4e125e785d1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "split"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9a9b242b-af41-4d6e-8c45-78d169d8563b",
                    "leftValue": "={{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.postbackData_action }}",
                    "rightValue": "single",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "single"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "550f2b02-a1d5-4b40-b2c1-3654882b7eb5",
                    "leftValue": "={{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.postbackData_action }}",
                    "rightValue": "retry",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "retry"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1200,
        -440
      ],
      "id": "6720b723-a938-41c3-8035-ca57579f64eb",
      "name": "Switch2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e4ca7143-759f-4999-8f0d-b31830685339",
              "name": "users",
              "value": "={{ $('Aggregate').item.json.line_user_id }}",
              "type": "array"
            },
            {
              "id": "62ee9260-c150-4283-bba3-47ff5dc91e5e",
              "name": "amount_split",
              "value": "={{ (() => { \n  const amount = $('Sheet-get_data').item.json.amount   \n  const count = $('Aggregate').item.json.line_user_id.length ;     \n  const base = Math.floor(amount / count);     \n  const remainder = amount % count;     \n  return Array.from({ length: count }, (_, i) => base + (i < remainder ? 1 : 0));   })() \n}}",
              "type": "array"
            },
            {
              "id": "cd17eec9-5bc0-4786-ad8d-f10a12d5e081",
              "name": "mode",
              "value": "åˆ†å¸³",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1000,
        -600
      ],
      "id": "df4ca611-83ec-4e29-9a22-d611182a8b0d",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e4ca7143-759f-4999-8f0d-b31830685339",
              "name": "users",
              "value": "=[\"{{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.line_uid}}\"]",
              "type": "array"
            },
            {
              "id": "44bc9ccb-65b9-4888-bc64-8b7b60b66e9e",
              "name": "amount_split",
              "value": "={{ (() => {     \n  const amount = $('Sheet-get_data').item.json.amount;     \n  const count = [\"$('è™•ç†æ‹†å¸³è³‡æ–™').item.json.line_uid\"].length;     \n  const base = Math.floor(amount / count);     \n  const remainder = amount % count;     \n  return Array.from({ length: count }, (_, i) => base + (i < remainder ? 1 : 0));   })() \n}}",
              "type": "array"
            },
            {
              "id": "6b8fb1ee-adc1-4bfc-a7f7-0a3986f49359",
              "name": "mode",
              "value": "å–®ç¨",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1000,
        -440
      ],
      "id": "24f00800-8ac7-4691-a1bb-b8e73fd0b017",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -560,
        -500
      ],
      "id": "88dc1f08-7482-4c64-a88e-24e04f84e260",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2",
              "name": "paid_user_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "amount",
              "value": "={{ $json.amount }}",
              "type": "number"
            },
            {
              "id": "4",
              "name": "transaction_date",
              "value": "={{ $('Sheet-get_data').item.json.datetime }}",
              "type": "string"
            },
            {
              "id": "6",
              "name": "transaction_id",
              "value": "={{ $('Sheet-get_data').item.json.id }}",
              "type": "string"
            },
            {
              "id": "f48569b5-9076-48de-aecd-77ec7101f370",
              "name": "paid_who",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -220,
        -460
      ],
      "id": "a3b6004c-a1c5-4a46-ad7d-c9b29340b2c0",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "jsCode": "const result = [];\n\nconst users = items[0].json.users;\nconst amounts = items[0].json.amount_split;\n\n// å–å¾— aggregate node çš„è³‡æ–™\nconst aggregateData = $node[\"Aggregate\"].json;\nconst lineUserIds = aggregateData.line_user_id;\nconst userNames = aggregateData.who;\n\nfor (let i = 0; i < users.length; i++) {\n  // å°‹æ‰¾å°æ‡‰çš„ user name\n  const userId = users[i];\n  const userIndex = lineUserIds.indexOf(userId);\n  const userName = userIndex !== -1 ? userNames[userIndex] : null;\n  \n  result.push({\n    json: {\n      id: userId,\n      name: userName,\n      amount: amounts[i]\n    }\n  });\n}\n\nreturn result;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -760,
        -500
      ],
      "id": "8c912df2-5501-4e8c-806c-cd92cf52a807",
      "name": "Code"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        140,
        -460
      ],
      "id": "c1f18232-7ee0-4d26-abfd-26928eb2ce57",
      "name": "Wait",
      "webhookId": "7bcbc208-8332-4f1c-88a0-7e2828da71e7"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer kSnAT2HQSvdZ0XsiM6v4670i7x6cXHKcmKZyif0bNQkk8WcmpeQ8/hPi9ccb4pEZjpWUep6S7wLhkhwgX4qbez3DO6tqUSei1p3F57T7bmy44eqBKGPDj1sE1XeF3MEobZ62ka1eCNHwP154IXEiXwdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n\"replyToken\": \"{{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $('Edit Fields2').item.json.mode }}æˆåŠŸ - ç´€éŒ„ {{ $('Loop Over Items').all().length }} ç­†\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -220,
        -620
      ],
      "id": "157e35f0-8a16-4cae-ab0d-a674f717ac16",
      "name": "HTTP Request1",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "298ac0a1-9313-4c6d-9124-b95d2211abc2"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bb3fb4b8-d0ac-41e9-b93a-365dc4054ae6",
                    "leftValue": "={{ $json.sentMessages }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        600,
        -800
      ],
      "id": "7c3936a2-e7e7-4d86-9920-056d2e7c75f8",
      "name": "Switch3"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C08J5MDH0UQ",
          "mode": "list",
          "cachedResultName": "log-n8n-slack"
        },
        "messageType": "block",
        "blocksUi": "={\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*{{ $workflow.name }}*-æˆåŠŸ\\n\"\n      }\n    }\n  ]\n}",
        "text": "è¨˜å¸³",
        "otherOptions": {
          "includeLinkToWorkflow": true,
          "botProfile": {
            "imageValues": {
              "profilePhotoType": "emoji",
              "icon_emoji": "ğŸ’¸"
            }
          },
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $json.ts }}"
            }
          }
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        820,
        -700
      ],
      "id": "38c45121-ee19-49d6-9d0f-340cad241085",
      "name": "log-æˆåŠŸè¨Šæ¯",
      "webhookId": "5e713cd2-99f8-41f3-b16a-8bcf9ad7e4ad",
      "credentials": {
        "slackOAuth2Api": {
          "id": "sD1J9ZLyEhcglrRa",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C08J5MDH0UQ",
          "mode": "list",
          "cachedResultName": "log-n8n-slack"
        },
        "messageType": "block",
        "blocksUi": "={\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*{{ $workflow.name }}*-Line Reply Message Log:\\n\"\n      }\n    },\n      {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"{{  '```' + $json.error.message.split(\" - \")[1].parseJson().parseJson().message + '```'}}\"\n      }\n    }\n  ]\n}",
        "text": "è¨˜å¸³",
        "otherOptions": {
          "includeLinkToWorkflow": true,
          "botProfile": {
            "imageValues": {
              "profilePhotoType": "emoji",
              "icon_emoji": "ğŸ’¸"
            }
          },
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $json.ts }}"
            }
          }
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        820,
        -900
      ],
      "id": "a41b11f0-b895-4ff5-9142-b98297ca937d",
      "name": "log-éŒ¯èª¤è¨Šæ¯",
      "webhookId": "fb603d13-b0a4-4e05-acb8-ec3b5182ba8a",
      "credentials": {
        "slackOAuth2Api": {
          "id": "sD1J9ZLyEhcglrRa",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "content": "## è™•ç†ä¸»è¨˜å¸³\nä½¿ç”¨è€…è¼¸å…¥æˆ–æ‹ç…§è³‡è¨Š\nè¾¨è­˜å¾Œå­˜å…¥å“ç›¸ã€åœ°é»ã€æ™‚é–“ç­‰è³‡è¨Šè‡³è³‡æ–™åº«ä¸­\nä¸¦ä¸”è©¢å•ä½¿ç”¨è€…æ˜¯å¦è¦æ‹†å¸³",
        "height": 580,
        "width": 2360
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1940,
        -1380
      ],
      "id": "b14673ce-ca0a-4c77-839b-a645b225be84",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## è™•ç†æ˜¯å¦åˆ†å¸³\nå›ºå®šæ‹†å¸³äººæ•¸ å¤š vs 1\næ ¹æ“šè¼¸å…¥ä¾†è¨˜å¸³\næ‹†å¸³çš„è©±æ ¹æ“šäººæ•¸ç›¸é™¤ï¼Œäº”å€‹äººçš„è©±é™¤ä»¥ 5 ä¸¦ä¸”è¨˜éŒ„äº”ç­†",
        "height": 640,
        "width": 2360,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1940,
        -680
      ],
      "id": "d7cbb732-9b11-4a2a-a6bf-fa65156edcc8",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Line Webhook Trigger\nä¸¦åˆ¤æ–·æ˜¯å¦ç‚º Message\næœªä¾†å¢åŠ åˆ¤æ–·ç‚ºæ˜¯å¦ç‚ºæŒ‡å®š channel\n",
        "height": 360,
        "width": 400,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2420,
        -1000
      ],
      "id": "7b0ea045-9d2b-46f9-aac5-3630bcfe431f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Slack ç´€éŒ„ Log\nå¦‚æœç™¼é€æˆåŠŸæˆ–å¤±æ•—\næœ‰åœ°æ–¹å¯ä»¥è¨˜éŒ„åæŸ¥\n\n",
        "height": 500,
        "width": 400,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        580,
        -1020
      ],
      "id": "d50f7563-ce36-4f26-be9f-998009b6be9d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e93c0025-9e8b-4ac9-bbf4-dfac966f8bfa",
              "leftValue": "={{ $json.body.events[0].type }}",
              "rightValue": "message",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2240,
        -800
      ],
      "id": "dad6db4c-5921-45b4-b921-6c501729a0c2",
      "name": "åˆ¤æ–·æ˜¯å¦ç‚º  Line message"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4c6e231b-1081-4bce-a18d-d05de459d747",
              "leftValue": "={{ $json.amount }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "184ffa00-1c28-4f38-ad4b-897a84f99205",
              "leftValue": "={{ $json.amount }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -380,
        -1240
      ],
      "id": "cb50f0b4-61b3-4316-9f33-1eb6f1854c4a",
      "name": "If"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer kSnAT2HQSvdZ0XsiM6v4670i7x6cXHKcmKZyif0bNQkk8WcmpeQ8/hPi9ccb4pEZjpWUep6S7wLhkhwgX4qbez3DO6tqUSei1p3F57T7bmy44eqBKGPDj1sE1XeF3MEobZ62ka1eCNHwP154IXEiXwdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n\"replyToken\": \"{{ $('å–Lineè³‡æ–™').item.json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"è¾¨è­˜å¤±æ•—ï¼Œå¦‚æœéœ€è¦è¨˜å¸³è«‹é‡æ–°è¼¸å…¥æˆ–ä¸Šå‚³\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        -1320
      ],
      "id": "1e8a04e4-b6c6-4d33-9ed9-a34ecb59d5a4",
      "name": "HTTP Request-Line Reply è¾¨è­˜å¤±æ•—",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer kSnAT2HQSvdZ0XsiM6v4670i7x6cXHKcmKZyif0bNQkk8WcmpeQ8/hPi9ccb4pEZjpWUep6S7wLhkhwgX4qbez3DO6tqUSei1p3F57T7bmy44eqBKGPDj1sE1XeF3MEobZ62ka1eCNHwP154IXEiXwdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n\"replyToken\": \"{{ $('è™•ç†æ‹†å¸³è³‡æ–™').item.json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"æˆåŠŸåˆªé™¤ä¸Šä¸€ç­†è³‡æ–™\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -760,
        -260
      ],
      "id": "6deae230-5d2b-4280-9a66-eea0b8d1fc53",
      "name": "HTTP Request-Line Reply Retry",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -840,
        -1240
      ],
      "id": "07f81608-8a23-483d-b781-8c279a9ab723",
      "name": "æ•´ç† AIAgent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1360,
        -920
      ],
      "id": "20ded418-e211-41b2-93f3-5d13ed556434",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "AE7fbXM0LWEUpaUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM",
          "mode": "list",
          "cachedResultName": "n8n-åœ–ç‰‡è¨˜å¸³-demo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1154469382,
          "mode": "list",
          "cachedResultName": "expense",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit#gid=1154469382"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.postbackData_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1720,
        -440
      ],
      "id": "027e48db-1072-497e-a512-afcf4e74349a",
      "name": "Sheet-get_data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "atsKA0m2aQXeL6i6",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM",
          "mode": "list",
          "cachedResultName": "n8n-åœ–ç‰‡è¨˜å¸³-demo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 539185368,
          "mode": "list",
          "cachedResultName": "split_user",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit#gid=539185368"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -1540,
        -440
      ],
      "id": "e6033730-1dff-4f1b-88e7-fc4e66deab22",
      "name": "Sheet-get_user_data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "atsKA0m2aQXeL6i6",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "who"
            },
            {
              "fieldToAggregate": "line_user_id"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1380,
        -440
      ],
      "id": "ff1f863e-c149-4c7a-88cf-4b0a0ba06d6f",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM",
          "mode": "list",
          "cachedResultName": "n8n-åœ–ç‰‡è¨˜å¸³-demo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1154469382,
          "mode": "list",
          "cachedResultName": "expense",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit#gid=1154469382"
        },
        "startIndex": "={{ $('Sheet-get_data').item.json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -980,
        -260
      ],
      "id": "267c3785-0a8a-4d18-a2dc-1e1636b86c57",
      "name": "åˆªé™¤è¨˜å¸³ä¸»è³‡æ–™_Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "atsKA0m2aQXeL6i6",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "o4-mini",
          "mode": "id"
        },
        "options": {
          "responseFormat": "json_object"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1200,
        -920
      ],
      "id": "9d558436-635b-4399-b48d-78b7c617df49",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "AE7fbXM0LWEUpaUf",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æ ¹æ“šæä¾›çš„åœ–ç‰‡åˆ†æè³‡è¨Š\nå¦‚æœæ˜¯æ–‡å­—ï¼Œè«‹ç›´æ¥åˆ†æ\næ–‡å­—å…§å®¹: {{ $json.text }}",
        "options": {
          "systemMessage": "=è«‹åš´æ ¼éµå®ˆä»¥ä¸‹è¦å‰‡é€²è¡Œæ”¶æ“šè³‡è¨Šæ“·å–èˆ‡å¡«å¯«ï¼š\n\n1. **å“é …ï¼ˆitemï¼‰**ï¼šè‹¥æ”¶æ“šä¸Šæœ‰å¤šå€‹å“é …ï¼Œè«‹å°‡å“é …åç¨±ç”¨ã€Œé€—è™Ÿã€åˆ†éš”å¡«å…¥æ­¤æ¬„ä½ã€‚\n\n2. **é‡‘é¡ï¼ˆamountï¼‰**ï¼šå¡«å¯«æ”¶æ“šä¸Šé¡¯ç¤ºçš„ç¸½é‡‘é¡ï¼ˆå«ç¨…ï¼‰ã€‚è‹¥åœ–ç‰‡ä¸Šçš„è²¨å¹£å–®ä½ç‚ºæ—¥åœ“ï¼ˆÂ¥ï¼‰ï¼Œè«‹å°‡é‡‘é¡æ›ç®—ç‚ºæ–°å°å¹£ï¼ˆTWDï¼‰ï¼ŒåŒ¯ç‡ç‚ºã€Œ1 JPY = 0.22 TWDã€ï¼Œä¸¦å››æ¨äº”å…¥è‡³æ•´æ•¸ã€‚\n\n3. **æ—¥æœŸæ™‚é–“ï¼ˆdatetimeï¼‰**ï¼š\n    - è‹¥åœ–ç‰‡ä¸­æœ‰æ˜ç¢ºçš„è¨˜å¸³æ™‚é–“ï¼ˆä¾‹å¦‚ï¼šã€Œ2024å¹´3æœˆ29æ—¥ 11:44ã€ï¼‰ï¼Œè«‹å°‡å…¶è½‰æ›ç‚ºã€Œyyyy-MM-dd HH:mm:ssã€æ ¼å¼ã€‚\n    - è‹¥ç„¡æ³•æ‰¾åˆ°æ˜ç¢ºæ™‚é–“ï¼Œè«‹æ–¼å‚™è¨»æ¬„æ¨™è¨»ã€Œæœªæä¾›æ™‚é–“ã€ã€‚\n\n4. **åœ°é»ï¼ˆplaceï¼‰**ï¼šå¡«å¯«å®Œæ•´åº—åèˆ‡åœ°å€ï¼ˆä¾‹å¦‚ï¼šã€ŒLAWSON ä¹…ãŒåŸä¸€ä¸ç›®åº—ï¼Œæ±äº¬éƒ½å¤§ç”°å€ä¹…ãŒåŸ1-2-3ã€ï¼‰ã€‚è‹¥åœ°å€ä¸å®Œæ•´æˆ–æœªæä¾›ï¼Œè‡³å°‘å¡«å¯«åº—åï¼ˆä¾‹å¦‚ï¼šã€ŒLAWSONã€ï¼‰ã€‚\n\n5. **ç¿»è­¯è¦å‰‡**ï¼š\n    - æ‰€æœ‰å…§å®¹è«‹ç¿»è­¯ç‚ºç¹é«”ä¸­æ–‡ï¼ˆä¾‹å¦‚ï¼šã€Œã‚«ãƒ©ã‚¢ã‚²ã‚¯ãƒ³ã€ç¿»è­¯ç‚ºã€Œç‚¸é›å¡Šã€ï¼‰ã€‚\n    - è‹¥é‡åˆ°ç‰¹æ®Šçš„æ—¥æ–‡å“ç‰Œåï¼ˆå¦‚ï¼šã€Œã‚¯ãƒŠã‚¤ãƒ—ã€ã€ã€Œããæ¹¯ã€ç­‰éé£Ÿå“å“ç‰Œï¼‰ï¼Œè«‹ä¿ç•™å…¶çœŸå¯¦å•†å“ç‰¹æ€§ï¼ˆä¾‹å¦‚æ²æµ´é¹½ã€æ³¡æ¹¯åŒ…ï¼‰ï¼Œé¿å…èª¤è­¯ç‚ºå¸¸è¦‹é£Ÿå“ã€‚\n\n6. **åŸå§‹è³‡æ–™ï¼ˆraw_dataï¼‰**ï¼šé¡å¤–å›å‚³ä¸€å€‹æ¬„ä½ã€ŒåŸå§‹è³‡æ–™ã€ï¼Œå…§å®¹ç‚ºå¾åœ–ç‰‡æ“·å–çš„å®Œæ•´åŸå§‹æ–‡å­—æˆ–æ•¸æ“šï¼Œä¸¦æå–é‡‘é¡ï¼Œé …ç›®ï¼Œåœ°å€å’Œæ—¥æœŸç­‰è³‡è¨Šï¼Œæä¾›å¾ŒçºŒAIå¯©æ ¸ä½¿ç”¨ã€‚\n7. å¦‚æœæœªæä¾›æ™‚é–“ï¼Œä½¿ç”¨ç¾åœ¨æ™‚é–“ {{ $now.format(\"yyyy-MM-dd HH:mm:ss\") }}\n8. response in json\n---\n\nå›å‚³æ ¼å¼ç¯„ä¾‹ï¼š\n{\n    \"item\": \"ç‚¸é›å¡Š, ç¤¦æ³‰æ°´\",\n    \"amount\": \"220\",\n    \"datetime\": \"2024-03-29 11:44:00\",\n    \"place\": \"LAWSON ä¹…ãŒåŸä¸€ä¸ç›®åº—ï¼Œæ±äº¬éƒ½å¤§ç”°å€ä¹…ãŒåŸ1-2-3\",\n    \"raw_data\": \"ã‚«ãƒ©ã‚¢ã‚²ã‚¯ãƒ³ã€ãƒŸãƒãƒ©ãƒ«ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ Â¥1000 2024å¹´3æœˆ29æ—¥ 11:44 LAWSON ä¹…ãŒåŸä¸€ä¸ç›®åº—\"\n}",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -1320,
        -1160
      ],
      "id": "4782172a-75a8-4f3b-a476-06e5f0bcdf0d",
      "name": "AI Agent-Image and Text",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM",
          "mode": "list",
          "cachedResultName": "n8n-åœ–ç‰‡è¨˜å¸³-demo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 564686819,
          "mode": "list",
          "cachedResultName": "split",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-6TOSROxfwigpYWRgV3USo8xXgbGqXHDFsc69ZDlVTM/edit#gid=564686819"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "amount": "={{ $json.amount }}",
            "paid_id": "={{ $json.paid_user_id }}",
            "transaction_date": "={{ $json.transaction_date }}",
            "transaction_id": "={{ $json.transaction_id }}",
            "paid_who": "={{ $json.paid_who }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "paid_id",
              "displayName": "paid_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paid_who",
              "displayName": "paid_who",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "amount",
              "displayName": "amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "transaction_date",
              "displayName": "transaction_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "transaction_id",
              "displayName": "transaction_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -40,
        -460
      ],
      "id": "328992d6-b41a-4d9e-8b5c-3d793e3cf04a",
      "name": "å¯«å…¥è¨˜å¸³èŠ±è²»è³‡æ–™_Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "atsKA0m2aQXeL6i6",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {
    "LineMessage": [
      {
        "json": {
          "headers": {
            "host": "darrellinfo-n8n.hnd1.zeabur.app",
            "user-agent": "LineBotWebhook/2.0",
            "content-length": "628",
            "content-type": "application/json; charset=utf-8",
            "x-forwarded-for": "147.92.150.194, 147.92.150.194",
            "x-forwarded-host": "darrellinfo-n8n.hnd1.zeabur.app",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-line-signature": "yOHGbWAsIpnpWb8nLYlpylDV1bKaUUnK1SgrF06PKG0=",
            "x-real-ip": "147.92.150.194",
            "x-zeabur-container-port": "5678",
            "x-zeabur-ip-country": "JP",
            "x-zeabur-request-id": "hnd1::31802945-09c0-43ed-ae91-72593fcd2e97",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "destination": "Uea2edf19952568f1b5416d038ef8f525",
            "events": [
              {
                "type": "message",
                "message": {
                  "type": "image",
                  "id": "556951860616101889",
                  "quoteToken": "wEa62EkdZNUCX-Nr261PHvs6nOQdP8tdNMX6J7IEenB-MFRwjUy87M3cFKZsM822rUHcEYlf8XaAlL5ZZCY7PbUBXlvDrqdjr7dTfQ370y8Y_cuE7HwxRP1EtI-wFZq335Yxb4NdajVQJsTfvU5HQg",
                  "contentProvider": {
                    "type": "line"
                  }
                },
                "webhookEventId": "01JRZ3D102CAF9AYC84JZE5DFC",
                "deliveryContext": {
                  "isRedelivery": false
                },
                "timestamp": 1744800482241,
                "source": {
                  "type": "group",
                  "groupId": "C486c1e833f139857a5fa084c566582c3",
                  "userId": "Uf297c04a8159ce62427d831365aee7dd"
                },
                "replyToken": "20243b2661ee493582c77db47f656c74",
                "mode": "active"
              }
            ]
          },
          "webhookUrl": "https://darrellinfo-n8n.hnd1.zeabur.app/webhook/5f7e16fd-da83-420d-a491-3df046f640d8",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "LineMessage": {
      "main": [
        [
          {
            "node": "åˆ¤æ–·æ˜¯å¦ç‚º  Line message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å–Lineè³‡æ–™": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¯«å…¥è¨˜å¸³ä¸»è³‡æ–™_Google Sheets1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "GetLineImage",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetLineImage": {
      "main": [
        [
          {
            "node": "AI Agent-Image and Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "AI Agent-Image and Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è™•ç†æ‹†å¸³è³‡æ–™": {
      "main": [
        [
          {
            "node": "Sheet-get_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "åˆªé™¤è¨˜å¸³ä¸»è³‡æ–™_Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "å¯«å…¥è¨˜å¸³èŠ±è²»è³‡æ–™_Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "log-éŒ¯èª¤è¨Šæ¯",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "log-æˆåŠŸè¨Šæ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–·æ˜¯å¦ç‚º  Line message": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è™•ç†æ‹†å¸³è³‡æ–™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "HTTP Request-Line Reply è¾¨è­˜å¤±æ•—",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å¯«å…¥è¨˜å¸³ä¸»è³‡æ–™_Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request-Line Reply Retry": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ•´ç† AIAgent": {
      "main": [
        [
          {
            "node": "å–Lineè³‡æ–™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        []
      ]
    },
    "Sheet-get_data": {
      "main": [
        [
          {
            "node": "Sheet-get_user_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sheet-get_user_data": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆªé™¤è¨˜å¸³ä¸»è³‡æ–™_Google Sheets": {
      "main": [
        [
          {
            "node": "HTTP Request-Line Reply Retry",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent-Image and Text",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent-Image and Text": {
      "main": [
        [
          {
            "node": "æ•´ç† AIAgent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "log-éŒ¯èª¤è¨Šæ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¯«å…¥è¨˜å¸³èŠ±è²»è³‡æ–™_Google Sheets": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "timeSavedPerExecution": 2
  },
  "versionId": "8267bb22-5e4c-4fa9-b77d-a8ce79ca2e3a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fddb3e91967f1012c95dd02bf5ad21f279fc44715f47a7a96a33433621caa253"
  },
  "id": "oNCchhjTQEPM5Ygu",
  "tags": [
    {
      "createdAt": "2025-01-19T06:09:02.745Z",
      "updatedAt": "2025-01-19T06:09:02.745Z",
      "id": "xikUDzkBnHMO9C6y",
      "name": "demo"
    }
  ]
}