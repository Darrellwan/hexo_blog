(function(){const e=document.getElementById("drop-area"),t=document.getElementById("fileElem"),n=document.getElementById("selectFile"),a=document.getElementById("loading-overlay"),r=document.querySelector(".progress"),o=document.querySelector("th.sort-icon"),i=document.getElementById("error-message");let s=[],l=0;function c(e){e.preventDefault(),e.stopPropagation()}function d(){e.classList.add("highlight")}function u(){e.classList.remove("highlight")}function m(){a.classList.add("active"),r.style.width="0%",function e(){let t=0;!function n(){t+=1,r.style.width=`${t}%`,t<100?requestAnimationFrame(n):setTimeout(p,500)}();requestAnimationFrame(e)}()}function p(){a.classList.remove("active")}function f(e){i.textContent=e,i.style.display="block",p()}function h(){i.style.display="none"}function g(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function y(e){const t=e.dataTransfer.files;v(t)}function v(e){e.length&&E(e[0])}function E(e){if(!e||"application/json"!==e.type)return void f("請上傳有效的 JSON 檔案。");m(),h();const t=new FileReader;t.onload=function(e){setTimeout(()=>{try{const t=JSON.parse(e.target.result);if(!t.containerVersion||!Array.isArray(t.containerVersion.tag))throw new Error("無效的 JSON 結構");!function(e){if(!e.length)return void f("containerVersion.tag 陣列為空。請檢查您的 JSON 檔案。");try{s=e.map(e=>{if(!e.tagId&&!e.name)throw new Error("無效的標籤結構");return{id:e.tagId||"N/A",name:e.name||"N/A",size:JSON.stringify(e).length/1024,paused:e.paused||!1}}),function(){const e=s.reduce((e,t)=>e+t.size,0);l=e/s.length}(),function(){s.sort((e,t)=>t.size-e.size)}(),function(){const e=document.getElementById("file-info-body"),t=document.createDocumentFragment();s.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n                <td>${g(e.id)}</td>\n                <td>${g(e.name)}</td>\n                <td><span class="${e.size>l&&e.size>5?"high-size":""}">${e.size.toFixed(2)} KB</span></td>\n                <td><span class="status ${e.paused?"status-paused":"status-active"}">${e.paused?"已暫停":"啟用中"}</span></td>\n            `,t.appendChild(n)}),e.innerHTML="",e.appendChild(t)}(),function(){const e=document.getElementById("stats");e.innerHTML=`\n            <p><strong>總標籤數：</strong> ${s.length}</p>\n            <p><strong>平均大小：</strong> ${l.toFixed(2)} KB</p>\n        `}(),h()}catch(e){f("處理標籤數據時出錯："+e.message)}}(t.containerVersion.tag)}catch(e){"無效的 JSON 結構"===e.message?f("JSON 檔案不包含預期的 containerVersion.tag 結構。請檢查您的檔案並重試。"):f("解析 JSON 檔案時出錯："+e.message)}p()},3e3)},t.onerror=function(){f("讀取檔案時出錯。請重試。"),p()},t.readAsText(e)}["dragenter","dragover","dragleave","drop"].forEach(t=>{e.addEventListener(t,c,!1)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,d,!1)}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,u,!1)}),e.addEventListener("drop",y,!1),n.addEventListener("click",()=>t.click()),t.addEventListener("change",e=>v(e.target.files)),o.addEventListener("click",function(){o.classList.toggle("desc"),s.reverse(),function(){const e=document.getElementById("file-info-body"),t=document.createDocumentFragment();s.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n                <td>${g(e.id)}</td>\n                <td>${g(e.name)}</td>\n                <td><span class="${e.size>l&&e.size>5?"high-size":""}">${e.size.toFixed(2)} KB</span></td>\n                <td><span class="status ${e.paused?"status-paused":"status-active"}">${e.paused?"已暫停":"啟用中"}</span></td>\n            `,t.appendChild(n)}),e.innerHTML="",e.appendChild(t)}()})})();
